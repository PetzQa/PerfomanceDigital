on: [push]

jobs:
  jmeter_job:
    runs-on: ubuntu-latest
    name: JMeter Test Execution
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install JMeter
        run: |
          sudo apt-get update
          sudo apt-get install -y openjdk-11-jdk  # Instala Java necessário
          wget https://downloads.apache.org//jmeter/binaries/apache-jmeter-5.5.tgz
          tar -xvzf apache-jmeter-5.5.tgz
          export PATH=$PATH:$(pwd)/apache-jmeter-5.5/bin  # Adiciona JMeter ao PATH

      - name: Run JMeter Tests
        run: |
          mkdir -p reports/jtl reports/html  # Cria os diretórios para relatórios
          for test_file in ./PerformanceDigital/**/*.jmx; do
            echo "Running JMeter test: $test_file"
            jmeter -n -t "$test_file" -l reports/jtl/"$(basename "$test_file" .jmx)".jtl -e -o reports/html/"$(basename "$test_file" .jmx)" || echo "Test $test_file failed, but continuing..."
          done

      - name: Upload HTML Reports
        uses: actions/upload-artifact@v3
        with:
          name: jmeter-html-report
          path: reports/html
